/**
 * picasso-plugin-q v0.7.0
 * Copyright (c) 2018 QlikTech International AB
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.picassoQ=t()}(this,function(){"use strict";function e(e){var t=0,r=e.children,n=r&&r.length;if(n)for(;--n>=0;)t+=r[n].value;else t=1;e.value=t}function t(e,t){var n,o,u,l,f,s=new a(e),c=+e.value&&(s.value=e.value),p=[s];for(null==t&&(t=r);n=p.pop();)if(c&&(n.value=+n.data.value),(u=t(n.data))&&(f=u.length))for(n.children=new Array(f),l=f-1;l>=0;--l)p.push(o=n.children[l]=new a(u[l])),o.parent=n,o.depth=n.depth+1;return s.eachBefore(i)}function r(e){return e.children}function n(e){e.data=e.data.data}function i(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function a(e){this.data=e,this.depth=this.height=0,this.parent=null}function o(e,t){"/"===e.charAt(0)&&(e=e.substring(1));for(var r=e.split("/"),n=void 0,i=t,a=0;a<r.length;a++){if("*"===r[a]&&Array.isArray(i)){var u=[];n=r.slice(a+1).join("/");for(var l=0;l<i.length;l++){var f=o(n,i[l]);Array.isArray(f)?u.push.apply(u,R(f)):u.push(f)}return u}if(!r[a]&&Array.isArray(i)){var s=new Array(i.length);n=r.slice(a+1).join("/");for(var c=0;c<i.length;c++)s[c]=o(n,i[c]);return s}r[a]in i&&(i=i[r[a]])}return i}function u(e,t){var r=t.cache,n=t.cube;if(!e)return"";var i=r.fields.indexOf(e),a=void 0,o=void 0;if(-1===i)for(var u=0;u<r.attributeDimensionFields.length;u++)if(-1!==(o=r.attributeDimensionFields[u]?r.attributeDimensionFields[u].indexOf(e):-1)){i=u;break}if(-1===i)for(var l=0;l<r.attributeExpressionFields.length;l++)if(-1!==(a=r.attributeExpressionFields[l]?r.attributeExpressionFields[l].indexOf(e):-1)){i=l;break}return function(e,t,r){return"number"==typeof t?e+"/*/qAttrExps/qValues/"+t:"number"==typeof r?e+"/*/qAttrDims/qValues/"+r:e}(function(e,t){var r=e,n=t.qDimensionInfo.length,i=t.qMeasureInfo.length,a=t.qEffectiveInterColumnSortOrder;r<n&&a?r=a.indexOf(r):r>=n&&a&&i>1&&-1!==a.indexOf(-1)&&(r=a.indexOf(-1));for(var o="/qData/*/qSubNodes",u=Math.max(0,Math.min(r,n)),l=0;l<u;l++)o+="/*/qSubNodes";if(e>=n)if(i>1)for(o+="/"+(e-n)+"/qSubNodes",++l;l<=n;l++)o+="/*/qSubNodes";else o+="/"+(e-n);return o}(i,n),a>=0?a:void 0,o>=0?o:void 0)}function l(e,t){return u(e,{cache:t.cache,cube:t.cube}).replace(/qSubNodes/g,"children").replace(/children$/g,"children/*").replace(/qData\/\*/,"")}function f(e,t,r,n){var i=[];if(!e||!e.length)return i;if(t<=0){var a=n>=0?[e[n]]:e;r?i.push.apply(i,R(a.map(function(e){return e[r]}))):i.push.apply(i,R(a))}else for(var o=0;o<e.length;o++)e[o].children&&e[o].children.length&&i.push.apply(i,R(f(e[o].children,t-1,r,n)));return i}function s(e,t){var r=t.cube;if(!e)return-1;var n=e.key(),i=!1,a=-1,o=-1,u=-1,l=-1,f=-1,s=void 0;Y.test(n)?(i=!0,a=+Y.exec(n)[1],s=n.replace(Y,"")):P.test(n)&&(f=+P.exec(n)[1],s=n.replace(P,"")),s&&(z.exec(s)?u=+z.exec(s)[1]:_.exec(s)&&(o=+_.exec(s)[1]));var c=r.qEffectiveInterColumnSortOrder;return l=i?c?c.indexOf(a):a:c&&-1!==c.indexOf(-1)?c.indexOf(-1):r.qDimensionInfo.length,{fieldDepth:l+1,pseudoMeasureIndex:f,attrDimIdx:u,attrIdx:o}}function c(e,t,r){var n=function(e,t,r,n){if(e===t)return r?Function("node","return node."+r+";"):function(e){return e};if(e>t){var i=Math.max(0,Math.min(100,e-t)),a=[].concat(R(Array(i))).map(String.prototype.valueOf,"parent").join(".");return r?Function("node","return node."+a+"."+r+";"):Function("node","return node."+a+";")}if(t>e){var o=Math.max(0,Math.min(100,t-e));return function(e){return f(e.children,o-1,r,n)}}return!1}(e.fieldDepth,t.fieldDepth,r,t.pseudoMeasureIndex),i=void 0;return t.attrDimIdx>=0?i=function(e){return e.qAttrDims.qValues[t.attrDimIdx]}:t.attrIdx>=0&&(i=function(e){return e.qAttrExps.qValues[t.attrIdx]}),{nodeFn:n,attrFn:i}}function p(e,r,n,i){var a=[];return(Array.isArray(e)?e:[e]).forEach(function(e){if(void 0!==e.field){var u=function(){var u=r.raw(),l=o("/qStackedDataPages/*/qData",u);if(!l||!l[0])return{v:void 0};var f=r.key(),p="object"===O(e.field)?e.field:r.field(e.field),d=i.normalizeConfig(e,r),h=d.props,v=d.main,m=Object.keys(h);n.tree||(n.tree=t(l[0],function(e){return e.qSubNodes}));var y=s(p,{cube:u,cache:n}),g=c({fieldDepth:0},y),b=g.nodeFn,q=g.attrFn,x=!!e.trackBy,M=O(e.trackBy),D={},E=[],I=b(n.tree);m.forEach(function(e){var t=h[e];(t.fields?t.fields:[t]).forEach(function(e){if(e.field)if(e.field===p)e.isSame=!0;else{var t=s(e.field,{cube:u,cache:n}),r=c(y,t,"data");e.accessor=r.nodeFn,e.attrAccessor=r.attrFn}})});for(var A=[],C=function(t){var r=I[t],n=q?q(r.data):r.data;if(v.filter&&!v.filter(n))return"continue";var a=function(e,t,r){var n=r.key,i={value:"function"==typeof e.value?e.value(t):void 0!==e.value?e.value:t};return i.label="function"==typeof e.label?e.label(t):void 0!==e.label?String(e.label):String(i.value),e.field&&(i.source={key:n,field:e.field.key()}),i}(v,n,{key:f});m.forEach(function(e){var t=h[e],i=t.fields||[t],o=void 0;t.fields&&(o=[]),i.forEach(function(i){var u=void 0,l=void 0;"primitive"===i.type?l=i.value:("function"==typeof i.value&&(u=i.value),i.accessor?(l=i.accessor(r),Array.isArray(l)?(i.attrAccessor&&(l=l.map(i.attrAccessor)),u&&(l=l.map(u),u=null),l=i.reduce?i.reduce(l):l):l=i.attrAccessor?i.attrAccessor(l):l):l=n),t.fields?o.push(u?u(l):l):(a[e]={value:u?u(l):l},a[e].label=String(a[e].value),i.field&&(a[e].source={field:i.field.key(),key:f}))}),o&&(a[e]={value:"function"==typeof t.value?t.value(o):o},a[e].label=String(a[e].value))}),x&&i.track({cfg:e,itemData:n,obj:a,target:E,tracker:D,trackType:M}),A.push(a)},S=0;S<I.length;S++){C(S)}x?a.push.apply(a,R(i.collect(E,{main:v,propsArr:m,props:h}))):a.push.apply(a,A)}();if("object"===(void 0===u?"undefined":O(u)))return u.v}}),a}function d(e,t,r){if(!e)return-1;var n=r.cache,i=n.fields.indexOf(e),a=-1,o=-1;if(-1===i)for(var u=0;u<n.attributeDimensionFields.length;u++)if(-1!==(o=n.attributeDimensionFields[u]?n.attributeDimensionFields[u].indexOf(e):-1)){i=u;break}if(-1===i)for(var l=0;l<n.attributeExpressionFields.length;l++)if(-1!==(a=n.attributeExpressionFields[l]?n.attributeExpressionFields[l].indexOf(e):-1)){i=l;break}if((i-=t.qArea.qLeft)<0||i>=t.qArea.qWidth)return-1;var f="row["+i+"]";return o>=0?Function("row","return "+f+".qAttrDims.qValues["+o+"];"):a>=0?Function("row","return "+f+".qAttrExps.qValues["+a+"];"):Function("row","return "+f+";")}function h(e,t,r){var n=r.key,i={value:"function"==typeof e.value?e.value(t):void 0!==e.value?e.value:t};return i.label="function"==typeof e.label?e.label(t):void 0!==e.label?String(e.label):String(i.value),e.field&&(i.source={key:n,field:e.field.key()}),i}function v(e,t,r,n){var i=[];return(Array.isArray(e)?e:[e]).forEach(function(e){if(void 0!==e.field){var a=t.raw(),o=t.key(),u="object"===O(e.field)?e.field:t.field(e.field),l=n.normalizeConfig(e,t),f=l.props,s=l.main,c=Object.keys(f),p=!!e.trackBy,v=O(e.trackBy),m={},y=[],g=[];a.qDataPages.forEach(function(t){var i=d(u,t,{cache:r});-1!==i&&t.qMatrix.forEach(function(a,l){var b=t.qArea.qTop+l,q=K({qRow:b},i(a)),x=h(s,q,{key:o});s.filter&&!s.filter(q)||(c.forEach(function(e){var n=f[e],i=n.fields||[n];if(n.fields&&(x[e]=[]),i.forEach(function(i,l){!function(e){var t=e.cache,r=e.f,n=e.mainCell,i=e.p,a=(e.prop,e.page),o=e.rowIdx,u=e.row,l=e.sourceKey,f=e.target,s=e.targetProp,c=n;if(i.field&&i.field!==r){var p=d(i.field,a,{cache:t});if(-1===p)return;c=K({qRow:o},p(u))}f[s]=h(i,c,{key:l})}({cache:r,f:u,mainCell:q,p:i,prop:e,props:f,page:t,rowIdx:b,row:a,sourceKey:o,target:n.fields?x[e]:x,targetProp:n.fields?l:e})}),n.fields){var l=x[e].map(function(e){return e.value}),s=x[e].map(function(e){return e.label});x[e]={value:"function"==typeof n.value?n.value(l):void 0!==n.value?n.value:l},x[e].label="function"==typeof n.label?n.label(s):void 0!==n.label?String(n.label):String(x[e].value)}}),p&&n.track({cfg:e,itemData:q,obj:x,target:y,tracker:m,trackType:v}),g.push(x))})}),p?i.push.apply(i,R(n.collect(y,{main:s,propsArr:c,props:f}))):i.push.apply(i,g)}}),i}function m(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function y(e,t,r,n){return e=e.toString(t),r[1]===r[1].toUpperCase()&&(e=e.toUpperCase()),e.length-e.indexOf(".")>10&&(e=e.slice(0,e.indexOf(".")+11)),e.replace(".",n||".")}function g(e,t,r){var n=void 0;return G.test(t)?e=y(e,Number(/\d{2}/.exec(t)[0]),t,r):Q.test(t)?e=y(e,8,t,r):Z.test(t)?e=y(e,10,t,r):ee.test(t)?e=y(e,16,t,r):te.test(t)?e=y(e,2,t,r):re.test(t)&&(n="",e<0&&(n="-",e=-e),e=0===(e=Math.floor(e))?"0":e<=5e5?n+(e=function(e,t){for(var r=void 0,n="",i=Number(String(e).slice(-3)),a=(e-i)/1e3,o=[0,1,4,5,9,10,40,50,90,100,400,500,900].reverse(),u=["0","I","IV","V","IX","X","XL","L","XC","C","CD","D","CM"].reverse();i>0;)for(r=0;r<o.length;r++)if(o[r]<=i){n+=u[r],i-=o[r];break}for(r=0;r<a;r++)n="M"+n;return t[1]!==t[1].toUpperCase()&&(n=n.toLowerCase()),n}(e,t)):t+n+e.toExponential(0)),e}function b(e,t,r){var n=m(e);return r?n:new RegExp(n||"",t)}function q(e,t,r){var n=void 0,i=void 0,a=e.pattern,o=void 0,u=void 0,l=void 0,f=void 0,s=void 0,c=void 0,p=void 0;a.indexOf("A")>=0&&(a=a.replace("A",""),e.abbreviate=!0),p=function(e,t){return t&&(t=m(t)),e&&(e=m(e)),new RegExp("(?:[#0]+"+e+")?[#0]+(?:"+t+"[#0]+)?")}(t,r),u=(o=(o=a.match(p))?o[0]:"")?a.substr(0,a.indexOf(o)):a,l=o?a.substring(a.indexOf(o)+o.length):"",o||(o=a?"#":"##########"),t&&t===r&&(i=(n=o.split(r)).pop(),o=n.join("")+r+i,t=""),f=t,t=/,/.test(r)?"Â¤":",",f&&(o=o.replace(b(f,"g"),t)),s=r,r=".",s&&(o=o.replace(b(s,"g"),r)),c=(c=o.match(/#/g))?c.length:0;var d=a.split(s),h=void 0;d[1]&&(h=d[1].match(ie)),e.prefix=u||"",e.postfix=l||"",e.pattern=a,e.maxPrecision=h?h.length:2,e.percentage=X.test(a),e.numericPattern=o||"",e.numericRegex=new RegExp(b(t,null,!0)+"|"+b(r,null,!0),"g"),e.groupTemp=f,e.decTemp=s,e.t=t,e.d=r,e.temp=c}function x(e,t,r,n,i){function a(e){return o.formatValue(e)}var o=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(ae,[null].concat(t)))}(i,e,t,r,n);return a.format=function(e,t,r,n){return o.format(t,e,r,n)},a.pattern=function(e){return e&&(o.pattern=e,o.prepare()),o.pattern},a}function M(e,t){for(var r=e.length;r<t;r++)e="0"+e;return e}function D(e){var t=e.toString().split(".");return t[1]?t=Number("0."+t[1]):0}function E(e,t){var r=function(e){var t=e,r=24*D(t),n=60*D(r),i=60*D(n),a=1e3*D(i);return{d:Math.floor(t),h:Math.floor(r),m:Math.floor(n),s:Math.floor(i),f:Math.round(a)}}(e),n=r.d,i=r.h,a=r.m,o=r.s,u=r.f,l=0,f=void 0;/w+|t+/gi.test(t)&&(f=new Date(1899,11,30+Math.floor(e),0,0,86400*(e-Math.floor(e))),isNaN(f.getTime())&&(f=null)),/D+/gi.test(t)||(i+=24*n),/h+/gi.test(t)||(a+=60*i),/m+/gi.test(t)||(o+=60*a),/w+/gi.test(t)&&(l=f?f.getDay()-1:0)<0&&(l=6);var s="";return f&&(s=f.getHours()>=12?"pm":"am"),{year:0,month:0,day:l,date:n,h:i,m:a,s:o,f:u,t:s}}function I(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(se,[null].concat(t)))}function A(e){function t(e){return n!==ce.INTERVAL?function(e){return new Date(1899,11,30+Math.floor(e),0,0,0,864e5*(e-Math.floor(e)))}(e):e}function r(e){return e=t(e),i.format(e)}var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS",i=I(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e,n);return r.format=function(e,r){return r=t(r),i.format(r,e)},r.locale=function(t){return i=I(t,e,n),this},r.qtype=function(e){return void 0!==e&&(n=e),n},r}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.meta,r=e.id,n=e.key,i=e.cube,a=e.localeInfo,o=e.fieldExtractor,u=e.value,l=void 0,f="qStateCounts"in t||"qSize"in t?"dimension":"measure",s=u||("dimension"===f?pe(i):de(i)),c="dimension"===f?"first":"avg",p=function(e,t){if(e&&e.qNumFormat&&-1!==["D","T","TS","IV"].indexOf(e.qNumFormat.qType))return A(e.qNumFormat.qFmt,e.qNumFormat.qType,t);var r="#",n=t&&void 0!==t.qThousandSep?t.qThousandSep:",",i=t&&void 0!==t.qDecimalSep?t.qDecimalSep:".",a="U",o=e&&!!e.qIsAutoFormat;return e&&e.qNumFormat&&(r=e.qNumFormat.qFmt||r,n=e.qNumFormat.qThou||n,i=e.qNumFormat.qDec||i,a=e.qNumFormat.qType||a,o=o&&-1===["M"].indexOf(e.qNumFormat.qType)),o&&(r="#"+i+"##A",a="U"),x(r,n,i,a,t)}(t,a),d={id:function(){return r},key:function(){return n},raw:function(){return t},title:function(){return t.qFallbackTitle||t.label},type:function(){return f},items:function(){return l||(l=o(d)),l},min:function(){return t.qMin},max:function(){return t.qMax},value:s,label:function(e){return e.qText||""},reduce:c,formatter:function(){return p},tags:function(){return t.qTags}};return d}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments[1],n=arguments[2],i=arguments[3];return"K"!==r.raw().qMode?null:function(e,r,n,i){var a="/qStackedDataPages/*/qData",u=r.raw(),f=o(a,u);if(!f||!f[0])return null;for(var s=t(f[0],e.children||function(e){return e.qSubNodes}),c=s.height,p=[],d=function(t){var o=i.normalizeConfig(e,r),f=o.props,s=o.main,c=Object.keys(f);p[t]={propsArr:c,props:f,main:s};var d=null,h=0===t;if(t>0){var v=u.qEffectiveInterColumnSortOrder[t-1];t>u.qEffectiveInterColumnSortOrder.length&&(v=u.qDimensionInfo.length),d=n.fields[v]}var m=d?l(d,{cube:u,cache:n}):a;c.forEach(function(e){var t=f[e];(t.fields?t.fields:[t]).forEach(function(e){if(e.field){var t=l(e.field,{cube:u,cache:n});if(t===m)e.isSame=!0;else if(h)e.isDescendant=!0,e.path=t+"/data";else{var r=t.match(/\//g).length>m.match(/\//g).length,i="";i=r?t.replace(m,"").replace(/^\/\*/,"")+"/data":Math.ceil((m.match(/\//g).length-t.match(/\//g).length)/2),e.isDescendant=r,e.path=i}}})})},h=0;h<=c;h++)d(h);var v=[],m=0;return s.each(function(e){var t=v[m++]=e.data,r=p[e.depth].propsArr,n=p[e.depth].props,i=p[e.depth].main;e.data={value:"function"==typeof i.value?i.value(t):t},r.forEach(function(r){var i=n[r],a=i.fields?i.fields:[i],u=void 0;i.fields&&(u=[]),a.forEach(function(n){var a=function(e){return e},l=void 0;if("primitive"===n.type)l=n.value;else if("function"==typeof n.value&&(a=function(e,t){return n.value(e,t)}),n.field){if(n.isSame)l=t;else if(n.isDescendant)l=o(n.path,e),Array.isArray(l)&&(l=l.map(a),a=n.reduce||function(e){return e.join(", ")});else if(n.path){for(var f=n.path||0,s=e,c=0;c<f;c++)s=s.parent;l=s.data.value}}else l=t;i.fields?u.push(a(l,e)):(e.data[r]={value:a(l,e)},n.source&&(e.data[r].source={field:n.source}))}),u&&(e.data[r]={value:"function"==typeof i.value?i.value(u,e):u})})}),s}(e,r,n,i)}function F(e,t,r){var n=r.cache,i=r.cube,a=r.pages,o=r.fieldExtractor,u=r.key,l=r.fieldKey,f=r.localeInfo;t.qAttrDimInfo&&(n.attributeDimensionFields[e]=t.qAttrDimInfo.map(function(e,t){return e?C({meta:e,id:u+"/"+l+"/qAttrDimInfo/"+t,key:l+"/qAttrDimInfo/"+t,cube:i,pages:a,fieldExtractor:o,value:function(e){return e.qElemNo},localeInfo:f}):void 0})),t.qAttrExprInfo&&(n.attributeExpressionFields[e]=t.qAttrExprInfo.map(function(e,t){return e?C({meta:e,id:u+"/"+l+"/qAttrExprInfo/"+t,key:l+"/qAttrExprInfo/"+t,cube:i,pages:a,fieldExtractor:o,localeInfo:f}):void 0}))}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,r=e.data,n=e.config,i=void 0===n?{}:n,a={attributeDimensionFields:[],attributeExpressionFields:[],fields:[]},o=r;if(!o.qDimensionInfo)throw new Error("The data input is not recognized as a hypercube");var u="K"===o.qMode?o.qStackedDataPages:o.qDataPages,l=k.util,f={key:function(){return t},raw:function(){return o},field:function(e){return function(e,t){var r=t.cache;if("number"==typeof e)return r.fields[e];var n=r.fields.slice();if((r.attributeDimensionFields||[]).forEach(function(e){return n.push.apply(n,R(e))}),(r.attributeExpressionFields||[]).forEach(function(e){return n.push.apply(n,R(e))}),"function"==typeof e){for(var i=0;i<n.length;i++)if(e(n[i]))return n[i];return!1}if("string"==typeof e){for(var a=0;a<n.length;a++)if(n[a].key()===e||n[a].title()===e)return n[a]}else if(e&&-1!==n.indexOf(e))return e;throw Error("Field not found: "+e)}(e,{cache:a,cube:o,pages:u})},fields:function(){return a.fields.slice()},extract:function(e){return function(e,t,r,n){var i=t.raw();return"K"===i.qMode?p(e,t,r,n):"S"===i.qMode?v(e,t,r,n):[]}(e,f,a,l)},hierarchy:function(e){return S(e,f,a,l)}},s=void 0;s="K"===o.qMode?function(e){return p({field:e},f,a,l)}:"S"===o.qMode?function(e){return v({field:e},f,a,l)}:function(){return[]};var c=o.qDimensionInfo;return c.forEach(function(e,r){var n="qDimensionInfo/"+r;a.fields.push(C({meta:e,id:t+"/"+n,key:n,cube:o,pages:u,fieldExtractor:s,localeInfo:i.localeInfo})),F(r,e,{cache:a,cube:o,pages:u,fieldExtractor:s,key:t,fieldKey:n,localeInfo:i.localeInfo})}),o.qMeasureInfo.forEach(function(e,r){var n="qMeasureInfo/"+r;a.fields.push(C({meta:e,id:t+"/"+n,key:n,cube:o,pages:u,fieldExtractor:s,localeInfo:i.localeInfo})),F(c.length+r,e,{cache:a,cube:o,pages:u,fieldExtractor:s,key:t,fieldKey:n,localeInfo:i.localeInfo})}),f}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2],n=t.byCells,i=t.primarySource,a=[],u={},l=e.isActive(),f=!1;return e.brushes().forEach(function(e){var t=function(e,t){var r=!1,n=0,i=e,a=""+i.substr(0,i.indexOf("qHyperCube")+10),u=!0;if(ve.test(e)){n=+ve.exec(e)[1];var l=e.replace(ve,"");if(r=!0,ye.test(l)){n=0;var f=+ye.exec(i)[2];isNaN(f)||(n=f,i=i.replace(/\/\d+$/,"")),u=!1}else if(ge.test(l)){var s=0;if(t){var c=o(a,t);s+=c.qMeasureInfo.length,s=c.qDimensionInfo.slice(0,n).reduce(function(e,t){return e+t.qAttrExprInfo.length},s),n=s+=+ge.exec(i)[1],r=!1}}}else if(me.test(e)){n=+me.exec(e)[1],r=!1;var p=e.replace(me,"");if(ye.test(p)){n=0;var d=+ye.exec(i)[2];isNaN(d)||(n=d,i=i.replace(/\/\d+$/,"")),u=!1,r=!0}else if(ge.test(p)){var h=0;if(t){var v=o(a,t);h+=v.qMeasureInfo.length,h=v.qDimensionInfo.reduce(function(e,t){return e+t.qAttrExprInfo.length},h),h=v.qMeasureInfo.slice(0,n).reduce(function(e,t){return e+t.qAttrExprInfo.length},h),n=h+=+ge.exec(i)[1]}}}return he.forEach(function(e){var t=V(e,2),r=t[0],n=t[1];i=i.replace(r,n)}),u&&(i=""+i.substr(0,i.indexOf("/qHyperCubeDef")+14)),i&&"/"!==i[0]&&(i="/"+i),{index:n,path:i,type:r?"dimension":"measure"}}(e.id,r);if("range"===e.type&&"measure"===t.type){var l=e.brush.ranges();l.length&&(f=!0,u.rangeSelectHyperCubeValues||(u.rangeSelectHyperCubeValues={path:t.path,ranges:[]}),l.forEach(function(e){return u.rangeSelectHyperCubeValues.ranges.push({qMeasureIx:t.index,qRange:{qMin:e.min,qMax:e.max,qMinInclEq:!0,qMaxInclEq:!0}})}))}if("range"===e.type&&"dimension"===t.type){var s=e.brush.ranges();s.length&&(f=!0,u.selectHyperCubeContinuousRange||(u.selectHyperCubeContinuousRange={path:t.path,ranges:[]}),s.forEach(function(e){return u.selectHyperCubeContinuousRange.ranges.push({qDimIx:t.index,qRange:{qMin:e.min,qMax:e.max,qMinInclEq:!0,qMaxInclEq:!1}})}))}if("value"===e.type&&"dimension"===t.type)if(n)u.selectHyperCubeCells||(u.selectHyperCubeCells={path:t.path,cols:[]}),u.selectHyperCubeCells.cols.push(t.index),e.id!==i&&(i||u.selectHyperCubeCells.values)||(u.selectHyperCubeCells.values=e.brush.values().map(function(e){return+e}).filter(function(e){return!isNaN(e)}),f=!!u.selectHyperCubeCells.values.length);else{var c=e.brush.values().map(function(e){return+e}).filter(function(e){return!isNaN(e)});f=!!c.length,a.push({params:[t.path,t.index,c,!1],method:"selectHyperCubeValues"})}}),!f&&l?[{method:"resetMadeSelections",params:[]}]:(u.rangeSelectHyperCubeValues&&a.push({method:"rangeSelectHyperCubeValues",params:[u.rangeSelectHyperCubeValues.path,u.rangeSelectHyperCubeValues.ranges,[],!0]}),u.selectHyperCubeContinuousRange&&a.push({method:"selectHyperCubeContinuousRange",params:[u.selectHyperCubeContinuousRange.path,u.selectHyperCubeContinuousRange.ranges]}),u.selectHyperCubeCells&&a.push({method:"selectHyperCubeCells",params:[u.selectHyperCubeCells.path,u.selectHyperCubeCells.values,u.selectHyperCubeCells.cols]}),a)}function N(e){k.util=e.data("matrix").util,e.data("q",k)}a.prototype=t.prototype={constructor:a,count:function(){return this.eachAfter(e)},each:function(e){var t,r,n,i,a=this,o=[a];do{for(t=o.reverse(),o=[];a=t.pop();)if(e(a),r=a.children)for(n=0,i=r.length;n<i;++n)o.push(r[n])}while(o.length);return this},eachAfter:function(e){for(var t,r,n,i=this,a=[i],o=[];i=a.pop();)if(o.push(i),t=i.children)for(r=0,n=t.length;r<n;++r)a.push(t[r]);for(;i=o.pop();)e(i);return this},eachBefore:function(e){for(var t,r,n=this,i=[n];n=i.pop();)if(e(n),t=n.children)for(r=t.length-1;r>=0;--r)i.push(t[r]);return this},sum:function(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,n=t.children,i=n&&n.length;--i>=0;)r+=n[i].value;t.value=r})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,r=function(e,t){if(e===t)return e;var r=e.ancestors(),n=t.ancestors(),i=null;for(e=r.pop(),t=n.pop();e===t;)i=e,e=r.pop(),t=n.pop();return i}(t,e),n=[t];t!==r;)t=t.parent,n.push(t);for(var i=n.length;e!==r;)n.splice(i,0,e),e=e.parent;return n},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){var e=[];return this.each(function(t){e.push(t)}),e},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t},copy:function(){return t(this).eachBefore(n)}};(function(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}).prototype=Object.create(a.prototype);var O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},H=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),j=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},V=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),R=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},Y=/^qDimensionInfo(?:\/(\d+))?/,P=/^qMeasureInfo\/(\d+)/,_=/\/qAttrExprInfo\/(\d+)/,z=/\/qAttrDimInfo\/(\d+)/,L=Object.prototype.hasOwnProperty,B=Object.prototype.toString,U=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===B.call(e)},W=function(e){if(!e||"[object Object]"!==B.call(e))return!1;var t=L.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&L.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var n;for(n in e);return void 0===n||L.call(e,n)},K=function e(){var t,r,n,i,a,o,u=arguments[0],l=1,f=arguments.length,s=!1;for("boolean"==typeof u&&(s=u,u=arguments[1]||{},l=2),(null==u||"object"!=typeof u&&"function"!=typeof u)&&(u={});l<f;++l)if(null!=(t=arguments[l]))for(r in t)n=u[r],u!==(i=t[r])&&(s&&i&&(W(i)||(a=U(i)))?(a?(a=!1,o=n&&U(n)?n:[]):o=n&&W(n)?n:{},u[r]=e(s,o,i)):void 0!==i&&(u[r]=i));return u},$=("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self,function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){!function(t,r){e.exports=r()}(0,function(){return function(e,t){if(!e||isNaN(+t))return t;var r,n,i,a,o,u,l,f,s,c,p=e.length,d=e.search(/[0-9\-\+#]/),h=d>0?e.substring(0,d):"",v=e.split("").reverse().join(""),m=v.search(/[0-9\-\+#]/),y=p-m,g=e.substring(y,y+1),b=y+("."===g||","===g?1:0),q=m>0?e.substring(b,p):"";if(e=e.substring(d,b),t="-"===e.charAt(0)?-t:+t,r=t<0?t=-t:0,n=e.match(/[^\d\-\+#]/g),i=n&&n[n.length-1]||".",a=n&&n[1]&&n[0]||",",e=e.split(i),t=t.toFixed(e[1]&&e[1].length),t=+t+"",u=e[1]&&e[1].lastIndexOf("0"),(!(f=t.split("."))[1]||f[1]&&f[1].length<=u)&&(t=(+t).toFixed(u+1)),s=e[0].split(a),e[0]=s.join(""),(o=e[0]&&e[0].indexOf("0"))>-1)for(;f[0].length<e[0].length-o;)f[0]="0"+f[0];else 0==+f[0]&&(f[0]="");if(t=t.split("."),t[0]=f[0],l=s[1]&&s[s.length-1].length){for(v="",y=(c=t[0]).length%l,p=c.length,b=0;b<p;b++)v+=c.charAt(b),!((b-y+1)%l)&&b<p-l&&(v+=a);t[0]=v}return t[1]=e[1]&&t[1]?i+t[1]:"","0"!==(n=t.join(""))&&""!==n||(r=!1),h+(r?"-":"")+n+q}})})),J={3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y","-3":"m","-6":"Î¼","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y"},X=/%$/,G=/^\(r(0[2-9]|[12]\d|3[0-6])\)/i,Q=/^\(oct\)/i,Z=/^\(dec\)/i,ee=/^\(hex\)/i,te=/^\(bin\)/i,re=/^\(rom\)/i,ne=/^(\(rom\)|\(bin\)|\(hex\)|\(dec\)|\(oct\)|\(r(0[2-9]|[12]\d|3[0-6])\))/i,ie=/#|0/g,ae=function(){function e(t,r,n,i,a){T(this,e),this.localeInfo=t,this.pattern=r,this.thousandDelimiter=n||",",this.decimalDelimiter=i||".",this.type=a||"numeric",this.patternSeparator=";",this.abbreviations=function(e,t){if(!e||!e.qNumericalAbbreviation)return J;var r={};return e.qNumericalAbbreviation.split(t).forEach(function(e){var t=e.split(":");2===t.length&&(r[t[0]]=t[1])}),r}(t,this.patternSeparator),this.prepare()}return H(e,[{key:"clone",value:function(){var t=new e(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type);return t.subtype=this.subtype,t}},{key:"format",value:function(e,t,r,n){return this.prepare(t,r,n),this.formatValue(e)}},{key:"prepare",value:function(e,t,r){var n=void 0;void 0===e&&(e=this.pattern),void 0===t&&(t=this.thousandDelimiter),void 0===r&&(r=this.decimalDelimiter),e?(this._prepared={positive:{d:r,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},negative:{d:r,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},zero:{d:r,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""}},n=this._prepared,e=e.split(this.patternSeparator),n.positive.pattern=e[0],n.negative.pattern=e[1],n.zero.pattern=e[2],ne.test(e[0])&&(n.positive.isFunctional=!0),e[1]?ne.test(e[1])&&(n.negative.isFunctional=!0):n.negative=!1,e[2]?ne.test(e[2])&&(n.zero.isFunctional=!0):n.zero=!1,n.positive.isFunctional||q(n.positive,t,r),n.negative&&!n.negative.isFunctional&&q(n.negative,t,r),n.zero&&!n.zero.isFunctional&&q(n.zero,t,r)):this._prepared={pattern:!1}}},{key:"formatValue",value:function(e){var t=this._prepared,r=void 0,n=void 0,i="",a=void 0,o=void 0,u="",l=void 0,f=void 0,s=void 0,c=void 0,p=void 0,d=e;if(isNaN(e))return""+d;if(e=+e,!1===t.pattern)return e.toString();if(0===e&&t.zero)return(t=t.zero).pattern;if(e<0&&t.negative?(t=t.negative,e=-e):t=t.positive,l=t.d,f=t.t,t.isFunctional)e=g(e,t.pattern,l);else{if(t.percentage&&(e*=100),t.abbreviate){var h=Object.keys(this.abbreviations).map(function(e){return parseInt(e,10)}).sort(function(e,t){return e-t}),v=void 0,m=h[0];for(s=0,n=Number(Number(e).toExponential().split("e")[1]);m<=n&&s<h.length;)m=h[++s];s>0&&(v=h[s-1]);var y=void 0;v&&n>0&&v>0?y=v:(n<0&&v<0||!v)&&(m<0&&m-n<=t.maxPrecision?y=m:v<=n&&!(m>0&&-n<=t.maxPrecision)&&(y=v)),y&&(i=this.abbreviations[y],e/=Math.pow(10,y))}if(a=Math.abs(e),r=t.temp,c=t.numericPattern,p=c.split(l)[1],"I"===this.type&&(e=Math.round(e)),o=e,p||"#"!==c.slice(-1)[0])if(a>=1e15||a>0&&a<=1e-14)e=a?a.toExponential(15).replace(/\.?0+(?=e)/,""):"0";else{var b=Number(e.toFixed(Math.min(20,p?p.length:0)).split(".")[0]),q=c.split(l)[0];if(q+=l,e=$(q,b)||"0",p){var x=Math.max(0,Math.min(14,p.length)),M=p.replace(/#+$/,"").length,D=("I"===this.type?0:a%1).toFixed(x).slice(2).replace(/0+$/,"");for(s=D.length;s<M;s++)D+="0";D&&(e+=l+D)}else 0===b&&(o=0)}else if(a>=Math.pow(10,r)||a<1||a<1e-4)0===e?e="0":a<1e-4||a>=1e20?(e=(e=o.toExponential(Math.max(1,Math.min(14,r))-1)).replace(/\.?0+(?=e)/,""),u=""):(e=e.toPrecision(Math.max(1,Math.min(14,r)))).indexOf(".")>=0&&(e=(e=e.replace(e.indexOf("e")<0?/0+$/:/\.?0+(?=e)/,"")).replace(".",l));else{for(c+=l,r=Math.max(0,Math.min(20,r-Math.ceil(Math.log(a)/Math.log(10)))),s=0;s<r;s++)c+="#";e=$(c,e)}e=e.replace(t.numericRegex,function(e){return e===f?t.groupTemp:e===l?t.decTemp:""}),o<0&&!/^-/.test(e)&&(e="-"+e)}return t.prefix+e+u+i+t.postfix}}],[{key:"getStaticFormatter",value:function(){return{prepare:function(){},formatValue:function(e){return""+e}}}}]),e}(),oe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ue=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],le=["January","February","March","April","May","June","July","August","September","October","November","December"],fe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],se=function(){function e(t,r,n){T(this,e);var i=t||{};if(i.qCalendarStrings||(i.qCalendarStrings={qLongDayNames:oe,qDayNames:ue,qLongMonthNames:le,qMonthNames:fe}),this.localeInfo=i,this.locale_days=i.qCalendarStrings.qLongDayNames.slice(),this.locale_days_abbr=i.qCalendarStrings.qDayNames.slice(),this.locale_months=i.qCalendarStrings.qLongMonthNames.slice(),this.locale_months_abbr=i.qCalendarStrings.qMonthNames.slice(),!r){var a;r=(a={},j(a,ce.TIME,i.qTimeFmt||"hh:mm:ss"),j(a,ce.DATE,i.qDateFmt||"YYYY-MM-DD"),j(a,ce.DATE_TIME,i.qTimestampFmt||"YYYY-MM-DD hh:mm:ss"),a)[n]}this.pattern=r}return H(e,[{key:"clone",value:function(){var t=new e(this.localeInfo,this.pattern);return t.subtype=this.subtype,t}},{key:"format",value:function(e,t){t||(t=this.pattern?this.pattern:"YYYY-MM-DD hh:mm:ss"),t=t.replace(/\[.+]|\[|]/g,"");var r=/t+/gi.test(t),n=void 0;e instanceof Date?n=function(e,t){var r=e.getHours(),n=e.getDay()-1;return t&&((r%=12)||(r=12)),n<0&&(n=6),{year:e.getFullYear(),month:e.getMonth(),day:n,date:e.getDate(),h:r,m:e.getMinutes(),s:e.getSeconds(),f:e.getMilliseconds(),t:e.getHours()>=12?"pm":"am"}}(e,r):(e<0&&(e=-e,t="-"+t),n=E(e,t));var i=function(e,t){return{"Y+|y+":{Y:""+Number((""+t.year).slice(-2)),YY:M((""+t.year).slice(-2),2),YYY:M((""+t.year).slice(-3),3),def:function(e){return M(""+t.year,e.length)}},"M+":{M:t.month+1,MM:M(""+(t.month+1),2),MMM:e.locale_months_abbr[t.month],def:e.locale_months[t.month]},"W+|w+":{W:t.day,WW:M(""+t.day,2),WWW:e.locale_days_abbr[t.day],def:e.locale_days[t.day]},"D+|d+":{D:t.date,def:function(e){return M(""+t.date,e.length)}},"h+|H+":{h:t.h,def:function(e){return M(""+t.h,e.length)}},"m+":{m:t.m,def:function(e){return M(""+t.m,e.length)}},"s+|S+":{s:t.s,def:function(e){return M(""+t.s,e.length)}},"f+|F+":{def:function(e){var r=""+t.f,n=e.length-r.length;if(n>0)for(var i=0;i<n;i++)r+="0";else n<0&&(r=r.slice(0,e.length));return r}},"t{1,2}|T{1,2}":{def:function(e){var r=t.t;return e[0].toUpperCase()===e[0]&&(r=r.toUpperCase()),r=r.slice(0,e.length)}}}}(this,n),a=[];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&a.push(o);var u=new RegExp(a.join("|"),"g");return t.replace(u,function(e){var t=void 0,r=void 0;for(r in i)if(Object.prototype.hasOwnProperty.call(i,r)&&(t=new RegExp(r)).test(e))break;if(!t)return"";var n=void 0;for(var a in i[r])if(a===e||a.toLowerCase()===e){void 0===(n=i[r][a])&&(n=i[r][a.toLowerCase()]);break}return void 0===n&&(n=i[r].def),"function"==typeof n&&(n=n(e)),n})}}]),e}(),ce={AUTO:"U",INTEGER:"I",NUMBER:"R",FIXED_TO:"F",MONEY:"M",DATE:"D",TIME:"T",DATE_TIME:"TS",INTERVAL:"IV"},pe=function(e){return"S"===e.qMode?function(e){return e.qElemNumber}:function(e){return e.qElemNo}},de=function(e){return"S"===e.qMode?function(e){return e.qNum}:function(e){return e.qValue}},he=[["qHyperCube","qHyperCubeDef"],["qDimensionInfo","qDimensions"],["qMeasureInfo","qMeasures"],["qAttrDimInfo","qAttributeDimensions"],["qAttrExprInfo","qAttributeExpressions"]],ve=/\/qDimensionInfo(?:\/(\d+))?/,me=/\/qMeasureInfo\/(\d+)/,ye=/\/qAttrDimInfo\/(\d+)(?:\/(\d+))?/,ge=/\/qAttrExprInfo\/(\d+)/;return N.qBrushHelper=w,N.selections=w,N});
//# sourceMappingURL=picasso-q.js.map
